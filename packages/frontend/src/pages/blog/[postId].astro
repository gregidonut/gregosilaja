---
import * as cheerio from "cheerio";
import { getCollection } from "astro:content";
import { Blog } from "@/utils/models";

import Layout from "@/layouts/Layout.astro";
import Header from "@/components/headerWrapper/HeaderWrapper.astro";
import Main from "@/components/main/Main.astro";

export async function getStaticPaths() {
    const blogData = await getCollection("blog");
    return blogData.map(function (bd) {
        return {
            params: { postId: bd.id },
            props: bd.data as Blog,
        };
    });
}
const { body, assets } = Astro.props as Blog;
const $ = cheerio.load(body);

$("img").each((_, element) => {
    const $img = $(element);
    const src = $img.attr("src");
    if (src && Object.keys(assets).includes(src)) {
        $img.attr(
            "src",
            `data:image/${assets[src]!.ext};base64,${assets[src]!.b64String}`,
        );
        $img.attr("width", "100%");
    }
    $img.attr("loading", "lazy");
});
---

<Layout title="Blog" description="My thoughts on my dev journey">
    <Header />
    <Main>
        <article><Fragment set:html={$.html()} /></article>
    </Main>
</Layout>
